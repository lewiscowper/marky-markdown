<!doctype html>
<html>
<head>
<title>marky-markdown tester</title>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/github-markdown-css/2.4.1/github-markdown.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/highlight.js/9.6.0/styles/tomorrow.min.css">
<style>
* { box-sizing: border-box; }
html, body { margin: 0; padding: 0; height: 100%; }
body {
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol";
}
header {
  margin: 0;
  padding: 0 0 .5rem 0;
  height: 7.25rem;
}
header h1 {
  background-color: #557;
  color: #fdfdfd;
  font-weight: lighter;
  font-size: 1.75rem;
  padding: .125rem 1rem .125rem 1rem;
  margin: 0;
}
#options {
  padding: 0 1rem 0 1rem;
  margin: .85rem 0 .85rem 0;
  font-size: .85rem;
}

#options input[type=checkbox] {
  margin-left: 1em;
}

#main {
  height: calc(100% - 7.25rem);
  position: relative;
  border-top: 1px solid #aaa;
}
#editor-container {
  position: relative;
  float: left;
  height: 100%;
  width: 50%;
  overflow: scroll;
}
#output-container {
  position: relative;
  float: right;
  height: 100%;
  width: 50%;
  padding: .5em .5em .5em 1em;
  border-left: .5rem solid #eaeaea;
  overflow: scroll;
}

#editor-controls {
  width: 50%;
  float: left;
}
#editor-controls button {
  padding: .25rem .75rem .25rem .75rem;
  margin-left: 1rem;
  cursor: pointer;
  text-transform: lowercase;
}
#output-controls {
  width: 50%;
  float: right;
  text-align: right;
  text-transform: lowercase;
}
#output-controls label {
  display: inline-block;
  cursor: pointer;
  padding: .25rem .75rem .25rem .75rem;
  border: 1px solid #aaa;
}
#output-controls input[type=radio] {
  display: none;
}
#output-controls input[type=radio] + label {
  background-color: unset;
}
#output-controls input[type=radio]:checked + label {
  background-color: #557;
  color: #fdfdfd;
}

#editor-container pre.ace_editor { margin-top: 0; }
</style>
</head>
<body>
<header>
  <h1>marky-markdown tester</h1>
  <form id="options" action="#">
    <label>version:
      <select id="version">
        <option value="9.0.1">9.0.1</option>
        <option value="9.0.0">9.0.0</option>
        <option value="8.1.0">8.1.0</option>
        <option value="8.0.0">8.0.0</option>
      </select>
    </label>
    <label><input type="checkbox" id="sanitize" checked> sanitize</label>
    <label><input type="checkbox" id="linkify" checked> linkify</label>
    <label><input type="checkbox" id="highlightSyntax" checked> highlightSyntax</label>
    <label><input type="checkbox" id="prefixHeadingIds" checked> prefixHeadingIds</label>
    <label><input type="checkbox" id="enableHeadingLinkIcons" checked> enableHeadingLinkIcons</label>
    <label><input type="checkbox" id="serveImagesWithCDN"> serveImagesWithCDN</label>
    <!-- debug option is only really useful on the command line -->
    <!-- <label><input type="checkbox" data-option="debug"> debug</label> -->
    <label><input type="checkbox" id="package"> package <input type="text" id="packageContents"></label>
  </form>
  <div id="editor-controls">
    <button id="clear-editor">Clear editor</button>
  </div>
  <form id="output-controls" action="#">
    <input type="radio" name="outputType" value="html" id="htmlView" checked><label for="htmlView">HTML</label>
    <input type="radio" name="outputType" value="source" id="sourceView"><label for="sourceView">Source</label>
    <input type="radio" name="outputType" value="debug" id="debugView"><label for="debugView">Debug</label>
  </form>
</header>
<section id="main">
  <section id="editor-container"><textarea id="editor">
# marky-markdown

`marky-markdown` is a markdown parser, written in NodeJS, that aims for 
parity with [GitHub-style markdown]. It is built on top of [`markdown-it`],
a [CommonMark] markdown parser. You can use marky-markdown: 

- [programmatically in NodeJS]
- [in your terminal]
- [in the browser] *does not yet support syntax highlighting

`marky-markdown` is the thing that parses package READMEs on 
http://www.npmjs.com. If you see a markdown parsing bug there,
[file an issue here]!

[file an issue here]: https://github.com/npm/marky-markdown/issues
[GitHub-style markdown]: https://help.github.com/articles/basic-writing-and-formatting-syntax/
[CommonMark]: http://spec.commonmark.org/
[`markdown-it`]: https://github.com/markdown-it/markdown-it
[programmatically in NodeJS]: #programmatic-usage
[in your terminal]: #command-line-usage
[in the browser]: #in-the-browser

## Node Version Support

marky-markdown strives to support all LTS, current, and maintenance
versions of Node.js. When a version of Node.js is EOL, we will EOL 
support for that version for marky-markdown.

For more information on Node.js LTS and support, click [here](https://github.com/nodejs/LTS).

- marky-markdown < `9.0.0` supports `0.10`, `0.12`, `iojs`, `4`, `5`
- marky-markdown >= `9.0.0` supports `0.12`, `4`, `6`

## Installation

```sh
npm install marky-markdown --save
```

## Programmatic Usage

marky-markdown exports a single function. For basic use, that function
takes a single argument: a string to convert.

```js
var marky = require("marky-markdown")
var html = marky("# hello, I'm markdown")
```

### Options

The exported function takes an optional options object
as its second argument:

```js
marky("some trusted string", {sanitize: false})
```

The default options are as follows:

```js
{
  sanitize: true,               // remove script tags and stuff
  linkify: true,                // turn orphan URLs into hyperlinks
  highlightSyntax: true,        // run highlights on fenced code blocks
  prefixHeadingIds: true,       // prevent DOM id collisions
  enableHeadingLinkIcons: true, // render icons inside generated section links
  serveImagesWithCDN: false,    // use npm's CDN to proxy images over HTTPS
  debug: false,                 // console.log() all the things
  package: null                 // npm package metadata
}
```

## Command-line Usage

You can use marky-markdown to parse markdown files in the shell.
The easiest way to do this is to install globally:

```
npm i -g marky-markdown
marky-markdown some.md &gt; some.html
```

## In the Browser

This module mostly works in the browser, with the exception of the `highlights` module.

You can `require('marky-markdown')` in scripts you browserify yourself,
or just use the standalone file in [dist/marky-markdown.js].

Note: Usage with [webpack](https://webpack.github.io/) requires that your
`webpack.config.js` configure a loader (such as
[json-loader](https://github.com/webpack/json-loader)) for .json files.

## Tests

```sh
npm install
npm test
```

## What it does

- Parses markdown with [markdown-it](https://github.com/markdown-it/markdown-it), a fast and [commonmark-compliant](http://commonmark.org/) parser.
- Removes broken and malicious user input with [sanitize-html](https://www.npmjs.com/package/sanitize-html)
- Applies syntax highlighting to [GitHub-flavored code blocks](https://help.github.com/articles/creating-and-highlighting-code-blocks/) using the [highlights](https://www.npmjs.com/package/highlights) library from [Atom](https://atom.io/).
- Converts `:emoji:`-style [shortcuts](http://www.emoji-cheat-sheet.com/) to unicode emojis.
- Converts headings (h1, h2, etc) into anchored hyperlinks.
- Converts relative GitHub links to their absolute equivalents.
- Converts relative GitHub images sources to their GitHub raw equivalents.
- Converts insecure Gravatar URLs to HTTPS.
- Converts list items with leading `[ ]` and `[x]` into [GitHub-style task lists](https://github.com/blog/1825-task-lists-in-all-markdown-documents)
- Wraps embedded YouTube videos so they can be styled.
- Parses and sanitizes `package.description` as markdown.
- Applies CSS classes to redundant content that closely matches npm package name and description.
- Applies CSS classes to badge images, so we can do something interesting with them one day.

### npm packages

Pass in an npm `package` object to do stuff like rewriting relative URLs
to their absolute equivalent on GitHub, normalizing package metadata
with redundant readme content, etc

```js
var package = {
  name: "foo",
  description: "foo is a thing",
  repository: {
    type: "git",
    url: "https://github.com/kung/foo"
  }
}

marky(
  "# hello, I am the foo readme",
  {package: package}
)
```

## Dependencies

- [github-slugger](https://github.com/Flet/github-slugger): Generate a slug just like GitHub does for markdown headings
- [github-url-to-object](https://github.com/zeke/github-url-to-object): Extract user, repo, and other interesting properties from GitHub URLs
- [highlights](https://github.com/atom/highlights): Syntax highlighter
- [highlights-tokens](https://github.com/zeke/highlights-tokens): A list of the language tokens used by the Atom.app [highlights](https://www.npmjs.com/package/highlights) syntax highlighter
- [innertext](https://github.com/revin/innertext): Extract the `innerText` from a snippet of HTML
- [is-badge](https://github.com/wooorm/is-badge): Check if a URL is a badge
- [lodash](https://github.com/lodash/lodash): A utility library delivering consistency, customization, performance, &amp; extras.
- [markdown-it](https://github.com/markdown-it/markdown-it): Markdown-it - modern pluggable markdown parser.
- [markdown-it-emoji](https://github.com/markdown-it/markdown-it-emoji): Markdown-it-emoji extension for Markdown-it that parses markdown emoji syntax to unicode.
- [markdown-it-expand-tabs](https://github.com/revin/markdown-it-expand-tabs): Replace leading tabs with spaces in fenced code blocks
- [markdown-it-lazy-headers](https://github.com/Galadirith/markdown-it-lazy-headers): Lazy ATX headers plugin for markdown-it
- [markdown-it-task-lists](https://github.com/revin/markdown-it-task-lists): Render GitHub-style [task lists](https://github.com/blog/1375-task-lists-in-gfm-issues-pulls-comments)
- [property-ttl](https://github.com/soldair/property-ttl): Save memory by nulling out a property after ttl if it has not been accessed
- [sanitize-html](https://github.com/punkave/sanitize-html): Clean up user-submitted HTML, preserving whitelisted elements and whitelisted attributes on a per-element basis
- [similarity](https://github.com/zeke/similarity): How similar are these two strings?

Extra syntax highlighting, in addition to what comes with [highlights](https://www.npmjs.com/package/highlights):

- [atom-language-diff](https://github.com/revin/atom-language-diff): Diff/patch files
- [atom-language-nginx](https://github.com/hnagato/atom-language-nginx): [NGINX](http://nginx.org/) configuration files
- [language-dart](https://github.com/Daegalus/atom-language-dart): [Dart](https://www.dartlang.org/) language
- [language-erlang](https://github.com/jonathanmarvens/atom-language-erlang): [Erlang](http://www.erlang.org/) language
- [language-glsl](https://github.com/hughsk/language-glsl): [OpenGL Shading Language](https://www.opengl.org/documentation/glsl/) files
- [language-haxe](https://github.com/theRemix/language-haxe): [Haxe](http://haxe.org/) language
- [language-ini](https://github.com/jacobbednarz/atom-language-ini): .ini configuration files
- [language-rust](https://github.com/zargony/atom-language-rust): [Rust](http://www.rust-lang.org/) language
- [language-stylus](https://github.com/matthojo/language-stylus): [Stylus](http://stylus-lang.com/) CSS preprocessor

## License

ISC
  </textarea></section>
  <section id="output-container"><section id="output" class="markdown-body"></section></section>
</section>
<script src="https://cdn.jsdelivr.net/g/highlight.js@9.6.0(highlight.min.js+languages/nginx.min.js+languages/diff.min.js+languages/dart.min.js+languages/erlang.min.js+languages/rust.min.js+languages/glsl.min.js+languages/haxe.min.js+languages/ini.min.js+languages/stylus.min.js+languages/bash.min.js+languages/markdown.min.js+languages/erb.min.js+languages/clojure.min.js+languages/cpp.min.js+languages/css.min.js+languages/go.min.js+languages/java.min.js+languages/javascript.min.js+languages/json.min.js+languages/less.min.js+languages/makefile.min.js+languages/perl.min.js+languages/php.min.js+languages/python.min.js+languages/ruby.min.js+languages/scss.min.js+languages/sql.min.js+languages/xml.min.js+languages/yaml.min.js),ace@1.2.4(min/ace.js+min/mode-markdown.js+min/theme-tomorrow.js)"></script>
<script>
var renderTimeout
var versionSelector = document.getElementById('version')

useMarky(versionSelector.value)

var editor = ace.edit('editor')

editor.getSession().setMode('ace/mode/markdown')
editor.getSession().setUseWrapMode(true)
editor.setTheme('ace/theme/tomorrow')
editor.setShowPrintMargin(false)
editor.setOption('minLines', 50)
editor.setOption('maxLines', 50000)

editor.getSession().on('change', function (e) {
  if (renderTimeout) {
    clearTimeout(renderTimeout)
  }
  renderTimeout = setTimeout(render, 300)
})

var query = 'header input[type=checkbox], #version, #packageContents, input[name=outputType]'
document.querySelectorAll(query).forEach(function (element) {
  element.addEventListener('change', render)
})

document.getElementById('clear-editor').addEventListener('click', function (e) {
  editor.setValue('')
})

function isChecked (id) {
  return document.getElementById(id).checked
}

function buildOptions () {
  return {
    sanitize: isChecked('sanitize'),
    linkify: isChecked('linkify'),
    highlightSyntax: false,
    prefixHeadingIds: isChecked('prefixHeadingIds'),
    enableHeadingLinkIcons: isChecked('enableHeadingLinkIcons'),
    serveImagesWithCDN: isChecked('serveImagesWithCDN'),
    package: isChecked('package')
  }
}

function render () {
  var options = buildOptions()
  var html = markyMarkdown(editor.getValue(), buildOptions())
  var outputTypeElements = document.getElementsByName('outputType')
  var viewTypes = Array.prototype.slice.call(outputTypeElements)
  var viewType = viewTypes.filter(function (e) { return e.checked })[0].value

  if (viewType === 'source') {
    var paragraph = document.createElement('p')
    paragraph.appendChild(document.createTextNode(html))
    document.getElementById('output').innerHTML = '<pre><code class="html">' + paragraph.innerHTML + '</code></pre>'
    document.querySelectorAll('#output pre code').forEach(function(e){ hljs.highlightBlock(e) })

  } else if (viewType === 'debug') {

  } else if (viewType === 'html') {
    document.getElementById('output').innerHTML = html
    if (isChecked('highlightSyntax')) {
      document.querySelectorAll('#output pre code').forEach(function(e){ hljs.highlightBlock(e) })
    }
  }
}

versionSelector.addEventListener('change', function (e) { useMarky(this.value) })

function useMarky (version) {
  var head = document.getElementsByTagName('head')[0]
  var scripts = document.querySelectorAll('head script.marky-markdown')
  for (var i = 0; i < scripts.length; i++) {
    head.removeChild(scripts[i])
  }

  delete window.markyMarkdown

  var scriptElement = document.createElement('script')
  scriptElement.onload = render
  scriptElement.src = 'js/marky-markdown-' + document.getElementById('version').value + '.min.js'
  scriptElement.id = 'marky-' + version
  scriptElement.className = 'marky-markdown'

  head.appendChild(scriptElement)
}
</script>
</body>
</html>
